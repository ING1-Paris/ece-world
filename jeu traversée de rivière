#include <allegro.h>
#include "time.h"
#include "stdbool.h"
#define SCREEN_W 640
#define SCREEN_H 480
#define LOG_SPEED 2
#define FROG_H 32
#define LOG_WIDTH 128
#define LOG_HEIGHT 64
void initrondin(int log_x[8],int log_y[8],int log_speed[8]){
    for (int i = 0; i < 4; i++) {
        log_x[i] = SCREEN_W;
        log_x[i+4]= SCREEN_W/2;
        log_speed[i] = (rand() % 4) + 1;
        log_speed[i+4] =log_speed[i] ;
}}
/*typedef struct grenouille{
    int x;
    int y;
}grenouille;
typedef struct rondin{
    int x;
    int y;
    int direction;
}rondin;*/
int est_sur_rondin(int x_grenouille, int y_grenouille, int x_rondin, int y_rondin, int largeur_rondin, int hauteur_rondin) {
    int sur_rondin = 0;
    if (y_grenouille>= y_rondin && y_grenouille<=y_rondin+hauteur_rondin) {
        if (x_grenouille >= x_rondin && x_grenouille <= x_rondin + largeur_rondin) {
            sur_rondin = 1;
        }
    }
    return sur_rondin;
}

int main() {
    // Initialiser Allegro
    allegro_init();
    install_keyboard();
    set_color_depth(desktop_color_depth());
    set_gfx_mode(GFX_AUTODETECT_WINDOWED, SCREEN_W, SCREEN_H, 0, 0);
    if (set_gfx_mode(GFX_AUTODETECT_WINDOWED,SCREEN_W,SCREEN_H,0,0)!=0)
    {
        allegro_message("prb gfx mode");
        allegro_exit();
        exit(EXIT_FAILURE);
    }

    // Charger les sprites à partir de fichiers bitmap
    BITMAP *frog_bmp = load_bitmap("C:\\Users\\redah\\projetalgogrenouille\\grenouilleoff.bmp", NULL);
    BITMAP *log_bmp = load_bitmap("C:\\Users\\redah\\projetalgogrenouille\\bois.bmp", NULL);
    BITMAP *fond= load_bitmap("C:\\Users\\redah\\projetalgogrenouille\\fond.bmp",NULL);
    if (!frog_bmp || !log_bmp || !fond) {
        allegro_message("Impossible de charger les sprites.");
        return 1;
    }


    // Créer les sprites de grenouille et de rondins de bois
    int frog_x = SCREEN_W / 2;
    int frog_y = SCREEN_H - FROG_H;
    int score = 0;


        // Faire sauter la grenouille
        // deplacement grenouille
        // Déclaration des variables
    int log_x[8] = { 0, 0, 0, 0,0, 0, 0, 0};
    int log_y[8] = { 120, 180, 240, 300 ,120, 180, 240, 300 };
    int log_speed[8] = { LOG_SPEED, -LOG_SPEED, LOG_SPEED, -LOG_SPEED ,LOG_SPEED, -LOG_SPEED, LOG_SPEED, -LOG_SPEED };
    for (int i = 0; i < 4; i++) {
        log_x[i] = SCREEN_W;
        log_x[i+4]= SCREEN_W/2;
        log_speed[i] = (rand() % 4) + 1;
        log_speed[i+4] =log_speed[i] ;
        /*if (rand() % 2 == 0) {
            log_speed[i] = -log_speed[i];
            log_speed[i+4] = -log_speed[i];
            log_x[i] = 0 - LOG_WIDTH;
            log_x[i+4] = 0 - LOG_WIDTH;
        }*/
    }
    BITMAP *buffer= create_bitmap(SCREEN_W,SCREEN_H);
    BITMAP *buffer2= create_bitmap(SCREEN_W,SCREEN_H);
    int frog_speed = 8;
    clear_bitmap(buffer2);
    clear_bitmap(buffer);
    BITMAP *buffer_rect= create_bitmap(SCREEN_W,SCREEN_H);
    srand(time(NULL));
// Boucle de jeu
        while (!key[KEY_ESC]) {
            clear_to_color(buffer, makecol(0, 0, 0));

            // Dessin du fond d'écran
            rectfill(buffer, 0, 0, SCREEN_W, SCREEN_H / 4, makecol(0, 255, 0));
            rectfill(buffer, 0, SCREEN_H - SCREEN_H / 4, SCREEN_W, SCREEN_H, makecol(0, 255, 0));
            rectfill(buffer,0,SCREEN_H/4,SCREEN_W,SCREEN_H-SCREEN_H/4, makecol(0,0,255));
            rest(20); // Pause de 20 ms pour limiter la vitesse d'exécution du programme
            
            textprintf_ex(screen, font, 10, 10, makecol(0, 0, 0), -1, "Temps : %d", score);
            vsync();
            acquire_screen();
            blit(buffer, screen, 0, 0, 0, 0, SCREEN_W, SCREEN_H);
            release_screen();
        }
// faire fonction grenouille qui tombe à l'eau (perdu avec temps =0)
// faire fonction gagner si la grenouille arrive à destination avec le temps
// faire fonction afficher le score du joueur




}END_OF_MAIN()



